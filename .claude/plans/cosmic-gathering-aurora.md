# setup-project.md の段階的レビューフロー化

## Context

現状の `setup-project.md` はヒアリング後に要件定義→設計→CLAUDE.md→git hook→ブレイクダウンを一気に生成するフローになっている。ブレイクダウンまで完了した後に要件や設計の変更が発覚し、手戻りが頻発している。

**目的:** フローを段階的レビュー付きに変更し、要件定義・設計それぞれでユーザー承認を得てから次に進むことで手戻りを防ぐ。

## 変更対象ファイル

- `.claude/commands/setup-project.md` — フロー定義の書き換え（唯一の変更ファイル）

## 変更内容

現在の7ステップフローを、**レビューゲート付きの4フェーズ**に再構成する。

### 新フロー概要

```
Phase 1: ヒアリング（仕様が一意に確定するまで繰り返し）
  ↓ 仕様確定
Phase 2: 要件定義書生成 → ユーザーレビュー → 承認
  ↓ 承認
Phase 3: 設計ドキュメント生成 → ユーザーレビュー → 承認
  ↓ 承認
Phase 4: CLAUDE.md生成 + タスクブレイクダウン → 完了案内
```

### 各フェーズ詳細

#### Phase 1: ヒアリング（仕様確定）

**現状との違い:** 1回のヒアリングで次に進むのではなく、仕様が一意に定まるまでAskUserQuestionで質問を繰り返す。

確認すべき項目：
- プロジェクト概要・目的
- ターゲットユーザー
- MVP機能一覧（各機能の具体的な振る舞いまで）
- 非機能要件（パフォーマンス、セキュリティ等）
- 技術スタック選択（nextjs-only / nextjs-fastapi / ios-swift）

**ゲート条件:** すべての機能の振る舞いが曖昧さなく定義されていること。不明点があればAskUserQuestionで追加質問する。

#### Phase 2: 要件定義書生成 + レビュー

1. `docs/requirements.md` を生成
2. AskUserQuestionで「要件定義書をレビューしてください」と確認
   - 選択肢: 「承認する」「修正が必要」
3. 修正が必要な場合 → 修正→再レビューを繰り返す
4. 承認されたらPhase 3へ

#### Phase 3: 設計ドキュメント生成 + レビュー

1. 以下を生成：
   - `docs/architecture.md`（システム構成、技術スタック）
   - `docs/database-schema.md`（ER図、テーブル定義）※iOSの場合はSwiftDataスキーマ
   - `docs/api-spec.md`（エンドポイント仕様）※該当する場合
2. AskUserQuestionで「設計ドキュメントをレビューしてください」と確認
   - 選択肢: 「承認する」「修正が必要」
3. 修正が必要な場合 → 修正→再レビューを繰り返す
4. 承認されたらPhase 4へ

#### Phase 4: CLAUDE.md生成 + タスクブレイクダウン

1. `project-templates/{{選択したスタック}}/CLAUDE.md` を基にCLAUDE.md生成
   - テンプレート使用ルールは現行と同じ（プレースホルダーのみ置換、それ以外は一字一句転記）
2. `docs/breakdown.md` にタスク一覧を作成
   - **git hook設定を最初のタスクとして含める**（commit前: lint/format/型チェック、push前: テスト実行）
3. 「docs/breakdown.md のタスク1から実装を始められます」と案内

### 削除される現行ステップ

- ステップ6「git hook設定」 → breakdown.mdのタスクに移動

## 検証方法

1. 変更後の `setup-project.md` を読み、フローが段階的レビュー付きになっていることを確認
2. 実際に `/setup-project` を実行し、各フェーズでレビューゲートが機能することを確認
