---
description: 実装計画とテストケースを設計
---

実装計画を立てます。

## 入力
$ARGUMENTS

引数は /research からの引継ぎ情報、または実装対象の説明

## 参照
@CLAUDE.md（エラーハンドリング方針、禁止事項）
@docs/breakdown.md（タスク情報・依存関係を確認）

## 手順
1. CLAUDE.mdを参照し、技術スタックとディレクトリ構造を確認
2. docs/breakdown.md で該当タスクの編集対象・依存関係・種別を確認
3. 機能を小さな単位に分解
4. テストケースを設計（正常系・異常系・境界値）
5. エラーハンドリングの計画
6. TDDで進める実装順序を決定

## 出力形式

### 📝 実装計画

#### タスク情報（Breakdownから）
- タスク番号: #X
- GitHub Issue: #Y
- 種別: [種別]
- 編集対象: `[ディレクトリ]`
- 依存タスク: [完了していることを確認]

#### 機能分解
1. [機能1]: [説明]
2. [機能2]: [説明]

#### テストケース
| # | 機能 | テストケース | 種別 |
|---|------|--------------|------|
| 1 | 機能1 | 正常系テスト | 正常系 |
| 2 | 機能1 | 異常系テスト | 異常系 |
| 3 | 機能1 | 境界値テスト | 境界値 |

#### エラーハンドリング計画
| エラー種別 | 対応方法 | ユーザーへの表示 |
|------------|----------|-----------------|
| [エラー1] | [対応] | [メッセージ] |

#### 外部サービス連携（該当する場合）
- リトライ戦略: [CLAUDE.mdの方針に従う]
- タイムアウト: [秒数]

#### 実装ステップ
```
Step 1: [機能1のテスト] → /test [対象]
Step 2: [機能1の実装] → /impl [対象]
...
```

#### ファイル構成
CLAUDE.mdのディレクトリ構造に従って配置先を決定

---

## 計画をIssueに保存（必須）

計画確定後、GitHub Issueにコメントとして保存してください：

```bash
gh issue comment [Issue番号] --body "## 実装計画

### 機能分解
1. [機能1]: [説明]
2. [機能2]: [説明]

### テストケース
| # | テストケース | 種別 |
|---|--------------|------|
| 1 | [テスト1] | 正常系 |
| 2 | [テスト2] | 異常系 |

### 実装ステップ
- [ ] Step 1: [機能1のテスト]
- [ ] Step 2: [機能1の実装]
...

### ファイル構成
- \`[パス]\`: [説明]
"
```

**重要**: `/clear` 後も Issue を見れば計画を確認できます。

---

## Worktree作成（並列開発対応）

計画をIssueに保存後、作業用worktreeを作成：

```bash
# worktreeディレクトリがなければ作成
mkdir -p .worktrees

# worktreeを作成（新しいブランチと作業ディレクトリを同時に作成）
git worktree add .worktrees/issue_[GitHub Issue番号] -b [種別]-issue_[GitHub Issue番号]
```

**ブランチ命名規則**: `[種別]-issue_[番号]`
- 種別: infra, db, api, ui, feature, test, docs
- 例: `infra-issue_1`, `api-issue_5`, `ui-issue_10`

**Worktree作成例**:
```bash
mkdir -p .worktrees
git worktree add .worktrees/issue_5 -b api-issue_5
```

---

## 次のステップ

Worktree作成後：

1. **新しいターミナルを開く**
2. **worktreeディレクトリに移動**: `cd .worktrees/issue_[番号]`
3. **Claude Codeを起動**: `claude`
4. `/clear` してから `/test` で開始

**注意**: 各worktreeは独立した作業ディレクトリです。複数のIssueを並列で開発できます。
（計画は Issue コメントを参照）
